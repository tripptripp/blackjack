<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackjack PWA</title>
    <link rel="manifest" href="manifest.json">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #4CAF50;
            color: white;
            text-align: center;
            padding: 20px;
        }
        .card {
            display: inline-block;
            width: 50px;
            height: 70px;
            background-color: white;
            color: black;
            border-radius: 5px;
            margin: 5px;
            font-size: 24px;
            line-height: 70px;
        }
        #controls {
            margin-top: 20px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
        }
        @media (max-width: 600px) {
            .card {
                width: 30px;
                height: 40px;
                font-size: 16px;
            }
            button {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>

<h1>Tripps Skibidi Blackjack Game</h1>
<div id="gameArea">
    <div id="dealerArea"></div>
    <div id="playerArea"></div>
</div>
<div id="controls">
    <button id="hitBtn">Hit</button>
    <button id="standBtn">Stand</button>
    <button id="restartBtn">Restart</button>
</div>
<div id="result"></div>

<script>
    // Register the service worker
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('service-worker.js')
        .then(() => {
            console.log('Service Worker Registered');
        })
        .catch(err => {
            console.error('Service Worker registration failed: ', err);
        });
    }

    let deck, playerHand, dealerHand;
    let dealerHidden = true; // Flag to indicate if the dealer's hole card is hidden
    const dealerArea = document.getElementById('dealerArea');
    const playerArea = document.getElementById('playerArea');
    const resultDiv = document.getElementById('result');

    function createDeck() {
        const suits = ['♥', '♦', '♣', '♠'];
        const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
        let deck = [];
        for (let suit of suits) {
            for (let value of values) {
                deck.push({ value, suit });
            }
        }
        return deck.sort(() => Math.random() - 0.5);
    }

    function startGame() {
        deck = createDeck();
        playerHand = [deck.pop(), deck.pop()];
        dealerHand = [deck.pop(), deck.pop()];
        dealerHidden = true; // Reset dealer hidden flag
        renderGame();
        resultDiv.textContent = '';
        
        // Re-enable buttons at the start of a new game
        document.getElementById('hitBtn').disabled = false;
        document.getElementById('standBtn').disabled = false;
    }

    function renderGame() {
        dealerArea.innerHTML = '';
        playerArea.innerHTML = '';

        // Render dealer's cards, hiding the second card if needed
        dealerHand.forEach((card, index) => {
            if (index === 1 && dealerHidden) {
                dealerArea.innerHTML += `<div class="card">??</div>`; // Hide the second card
            } else {
                dealerArea.innerHTML += `<div class="card">${card.value}${card.suit}</div>`;
            }
        });

        playerHand.forEach(card => playerArea.innerHTML += `<div class="card">${card.value}${card.suit}</div>`);
    }

    function calculateScore(hand) {
        let score = 0;
        let aces = 0;
        for (let card of hand) {
            if (card.value === 'A') {
                aces++;
                score += 11;
            } else if (['K', 'Q', 'J'].includes(card.value)) {
                score += 10;
            } else {
                score += parseInt(card.value);
            }
        }
        while (score > 21 && aces) {
            score -= 10;
            aces--;
        }
        return score;
    }

    function hit() {
        playerHand.push(deck.pop());
        if (calculateScore(playerHand) > 21) {
            resultDiv.textContent = 'You bust! Dealer wins!';
            dealerHidden = false; // Reveal dealer's card since player busts
            renderGame();
            document.getElementById('hitBtn').disabled = true;
            document.getElementById('standBtn').disabled = true;
        }
        renderGame();
    }

    function stand() {
        dealerHidden = false; // Reveal the dealer's hidden card
        renderGame(); // Update the display to show the dealer's card

        while (calculateScore(dealerHand) < 17) {
            dealerHand.push(deck.pop());
        }
        const playerScore = calculateScore(playerHand);
        const dealerScore = calculateScore(dealerHand);
        if (dealerScore > 21 || playerScore > dealerScore) {
            resultDiv.textContent = 'You win!';
        } else if (playerScore < dealerScore) {
            resultDiv.textContent = 'Dealer wins!';
        } else {
            resultDiv.textContent = 'It\'s a tie!';
        }
        document.getElementById('hitBtn').disabled = true;
        document.getElementById('standBtn').disabled = true;
    }

    document.getElementById('hitBtn').addEventListener('click', hit);
    document.getElementById('standBtn').addEventListener('click', stand);
    document.getElementById('restartBtn').addEventListener('click', startGame);

    // Start the game on load
    startGame();
</script>
</body>
</html>